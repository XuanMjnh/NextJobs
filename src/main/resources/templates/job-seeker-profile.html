<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org/" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <link
            th:rel="stylesheet"
            th:href="@{/webjars/bootstrap/css/bootstrap.min.css} "
    />
    <link
            rel="stylesheet"
            type="text/css"
            media="all"
            th:href="@{/css/font-awesome.min.css}"
    />
    <link
            rel="stylesheet"
            type="text/css"
            media="all"
            th:href="@{/css/styles.css}"
    />
    <link
            href="https://fonts.googleapis.com/css?family=Montserrat"
            rel="stylesheet"
    />
    <meta charset="UTF-8"/>
    <title>Thông tin cá nhân</title>
</head>

<body class="background">
<div>
    <label class="mt-4 ms-5">
        <a th:href="@{/dashboard/}"
           class="btn fw-bold"
           style="background-color: #164081; color: white; border: none;">
            NextJobs
        </a>
    </label>
</div>
<div class="add-job-container">

    <div class="profile-container-seeker shadow-effect">
        <div class="add-job-title" sec:authorize="hasAuthority('Job Seeker')"><h2>Thông tin cá nhân</h2></div>
        <div class="add-job-title" sec:authorize="hasAuthority('Recruiter')"><h2>Thông tin ứng viên ứng tuyển</h2></div>
        <form
                th:action="@{/job-seeker-profile/addNew}"
                th:object="${profile}"
                method="post"
                enctype="multipart/form-data"
                id="job-main-form"
        >
            <div class="add-row">
                <input

                        id="user_account_id"
                        th:field="*{userAccountId}"
                        name="userAccountId"
                        type="text"
                        hidden
                />
                <div class="add-row-title">Họ và Tên</div>
                <div class="add-row-row">
                    <input placeholder="Họ" id="firstName" th:field="*{firstName}"  name="firstName"  type="text" class="form-control"  />
                    <input placeholder="Tên" id="lastName" name="lastName" th:field="*{lastName}" type="text" class="form-control"  />
                </div>
            </div>
            <div class="add-row">
                <div class="add-row-title">Email</div>
                <input th:field="*{userId.email}" type="text" class="form-control"  disabled />
            </div>
            <div class="add-row">
                <div class="add-row-title">Địa chỉ</div>
                <div class="add-row-row">
                    <input th:field="*{city}" id="city" type="text"  class="form-control" placeholder="Địa chỉ">
                    <input id="state" th:field="*{state}" type="text"  class="form-control" placeholder="Xã/phường">
                    <input id="country" th:field="*{country}" type="text"  class="form-control" placeholder="Tỉnh/thành phố">
                </div>
            </div>

            <div class="add-row">
                <div class="add-row-title">Trình độ học vấn</div>
                <input id="certificate" th:field="*{certificate}" class="form-control" placeholder="Trình độ">
            </div>
            <div class="add-row">
                <div class="add-row-title">Kinh nghiệm làm việc</div>
                <input id="experience" th:field="*{experience}" class="form-control" placeholder="Kinh nghiệm">
            </div>

            <div class="add-row">
                <div class="add-row-title">Skills</div>
                <div class="parent" th:each="skills, iterStat : *{skills}">
                    <div id="skill-repeat" style="margin-bottom: 10px">
                        <div class="row">
                            <div class="col-md-4 pr-1">
                                <input
                                        type="text"
                                        th:field="*{skills[__${iterStat.index}__].id}"
                                        hidden

                                />
                                <input
                                        placeholder="Kĩ năng"
                                        type="text"
                                        class="form-control"
                                        th:field="*{skills[__${iterStat.index}__].name}"
                                />
                            </div>
                            <div class="col-md-4 px-1">
                                <input
                                        placeholder="Số năm kinh nghiệm"
                                        type="text"
                                        class="form-control"
                                        th:field="*{skills[__${iterStat.index}__].yearsOfExperience}"
                                />
                            </div>
                            <div class=" col-md-4 pl-1">
                                <select
                                        required
                                        class="form-control"
                                        th:field="*{skills[__${iterStat.index}__].experienceLevel}"
                                >
                                    <option value="Experience Level" selected>Trình độ</option>
                                    <option value="Beginner">Hiểu biết</option>
                                    <option value="Intermediate">Có kinh nghiệm</option>
                                    <option value="Advance">Thành thạo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row gutters" sec:authorize="hasAuthority('Job Seeker')">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="text-left mt-2">
                            <button
                                    type="button"
                                    class="btn btn-outline-secondary"
                                    id="addSkill"
                            >
                                Thêm
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="add-row">
                <div class="add-row-title">Ảnh đại diện</div>
                <div class="add-row-row">
                    <input id="image" type="file" name="image" class="form-control" accept="image/png, image/jpeg" style="display:none;">
                    <input type="text" name="profilePhoto" th:field="*{profilePhoto}" hidden />
                </div>

                <div class="add-row-row">
                    <img id="logoPreview"
                         th:src="${profile.profilePhoto != null && profile.profilePhoto != '' ?
                 '/photos/candidate/' + profile.userAccountId + '/' + profile.profilePhoto :
                 '/assets/default-avatar.png'}"
                         alt="Ảnh đại diện"
                         style="display:block; margin-top:10px; max-height:120px; border-radius:8px; border: 1px solid #c8c8c8;">
                </div>

                <label for="image" class="btn btn-outline-secondary" style="margin-top:10px" sec:authorize="hasAuthority('Job Seeker')">Chọn/Cập nhật ảnh</label>
            </div>

            <div class="add-row">
                <div class="add-row-title">CV</div>
                <div class="add-row-row">
                    <input type="file" name="pdf" class="form-control" accept="application/pdf" style="display:none;" id="CV"/>
                    <input type="text" name="resume" th:field="*{resume}" hidden/>

                    <div>
                      <span id="resumeName"
                            th:text="${profile.resume != null && profile.resume != '' ? profile.resume : 'Chưa có CV'}"
                            style="color: green"></span>
                        <label for="CV" class="btn btn-outline-secondary" sec:authorize="hasAuthority('Job Seeker')">Chọn/Cập nhật CV</label>
                        <a th:if="${profile.resume != null && profile.resume != ''}"
                           th:href="@{|/job-seeker-profile/downloadResume?fileName=${profile.resume}&&userID=${profile.userAccountId}|}"
                           class="btn btn-outline-secondary">Tải xuống</a>
                    </div>
                </div>
            </div>

            <button type="submit" name="submit" class="myBtn btn-save" sec:authorize="hasAuthority('Job Seeker')">Lưu</button>
        </form>
    </div>
</div>
<div sec:authorize="hasAuthority('Recruiter')">

</div>
</body>
<script
        type="text/javascript"
        th:src="@{/webjars/jquery/jquery.min.js}"
></script>
<script
        type="text/javascript"
        th:src="@{/webjars/popper.js/umd/popper.min.js}"
></script>
<script
        type="text/javascript"
        th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"
></script>
<script type="text/javascript" th:src="@{/js/main.js}"></script>
<script sec:authorize="hasAuthority('Recruiter')">
    console.log("Disable inputs");
    $("input").prop( "disabled", true );
    $("select").prop( "disabled", true );
    $("button").prop( "disabled", true );
</script>
<script>


    var counter = 0;
    $(document).on("click", "#addSkill", function (e) {
        e.preventDefault();
        counter++;
        var newRow = jQuery("<div id='skill-repeat' style=\"margin-bottom: 10px\"><div class='row'>"+
            "    <div class='col-md-4 pr-1'>"+
            "     <input"+
            "        hidden type='text'"+
            "        class='form-control' "+
            "        name='skills["+counter+"].Id'"+
            "      />"+
            "      <input"+
            "        placeholder='Kĩ năng'"+
            "        type='text'"+
            "        class='form-control'"+
            "        name='skills["+counter+"].name'"+
            "      />"+
            "    </div>"+
            "    <div class='col-md-4 px-1'>"+
            "      <input"+
            "        placeholder='Số năm kinh nghiệm'"+
            "        type='text'"+
            "        class='form-control'"+
            "        name='skills["+counter+"].yearsOfExperience'"+
            "      />"+
            "    </div>"+
            "    <div class='col-md-4 pl-1'>"+
            "      <select"+
            "        required"+
            "        class='form-control'"+
            "        name='skills["+counter+"].experienceLevel'"+
            "      >"+
            "        <option selected>Trình độ</option>"+
            "        <option value='Beginner'>Hiểu biết</option>"+
            "        <option value='Intermediate'>Có kinh nghiệm</option>"+
            "        <option value='Advance'>Thành thạo</option>"+
            "      </select>"+
            "    </div>"+
            "  </div>"+
            "</div>");
        console.log(newRow);
        $('#skill-repeat')
            .parent('div.parent')
            .append(newRow);

    });
</script>
<script>
    const fileInput = document.getElementById('image');
    const previewImg = document.getElementById('logoPreview');

    fileInput.addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => previewImg.src = e.target.result;
            reader.readAsDataURL(file);
        }
    });

</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const cvInput = document.getElementById("CV");
        const resumeName = document.getElementById("resumeName");

        if (cvInput && resumeName) {
            cvInput.addEventListener("change", function () {
                const file = this.files[0];
                if (file) {
                    resumeName.textContent = file.name;
                    resumeName.style.color = "green";
                }
            });
        }
    });

</script>

</html>